# 01-å¿«é€Ÿå…¥é—¨

æ¬¢è¿æ¥åˆ° Barter-rsï¼æœ¬æ•™ç¨‹å°†å¸®åŠ©ä½ åœ¨ 5-10 åˆ†é’Ÿå†…è¿è¡Œç¬¬ä¸€ä¸ªç¤ºä¾‹ï¼Œå¿«é€Ÿäº†è§£ Barter-rs çš„åŸºæœ¬ç”¨æ³•ã€‚

## ğŸ¯ å­¦ä¹ ç›®æ ‡

å®Œæˆæœ¬æ•™ç¨‹åï¼Œä½ å°†èƒ½å¤Ÿï¼š

-   âœ… å®‰è£…å’Œé…ç½® Barter-rs å¼€å‘ç¯å¢ƒ
-   âœ… è¿è¡Œç¬¬ä¸€ä¸ª Barter-rs ç¤ºä¾‹
-   âœ… ç†è§£åŸºæœ¬çš„ä»£ç ç»“æ„
-   âœ… çŸ¥é“ä¸‹ä¸€æ­¥è¯¥å­¦ä¹ ä»€ä¹ˆ

## ğŸ“‹ å‰ç½®è¦æ±‚

åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿ä½ å·²ç»å®‰è£…ï¼š

-   **Rust**ï¼ˆç‰ˆæœ¬ 1.70+ï¼‰
-   **Cargo**ï¼ˆRust çš„åŒ…ç®¡ç†å™¨ï¼‰

å¦‚æœä½ è¿˜æ²¡æœ‰å®‰è£… Rustï¼Œè¯·è®¿é—® [rustup.rs](https://rustup.rs/) å®‰è£…ã€‚

éªŒè¯å®‰è£…ï¼š

```bash
rustc --version
cargo --version
```

## ğŸš€ ç¬¬ä¸€æ­¥ï¼šå…‹éš†é¡¹ç›®

```bash
git clone https://github.com/barter-rs/barter-rs.git
cd barter-rs
```

## ğŸ“¦ ç¬¬äºŒæ­¥ï¼šæŸ¥çœ‹é¡¹ç›®ç»“æ„

Barter-rs æ˜¯ä¸€ä¸ªå·¥ä½œç©ºé—´ï¼ˆworkspaceï¼‰é¡¹ç›®ï¼ŒåŒ…å«å¤šä¸ª crateï¼š

```
barter-rs/
â”œâ”€â”€ barter/              # æ ¸å¿ƒäº¤æ˜“å¼•æ“
â”œâ”€â”€ barter-data/         # å¸‚åœºæ•°æ®æµ
â”œâ”€â”€ barter-execution/    # è®¢å•æ‰§è¡Œ
â”œâ”€â”€ barter-instrument/   # äº¤æ˜“å·¥å…·
â”œâ”€â”€ barter-integration/  # åº•å±‚é›†æˆæ¡†æ¶
â””â”€â”€ barter-macro/        # å®å®šä¹‰
```

## ğŸƒ ç¬¬ä¸‰æ­¥ï¼šè¿è¡Œç¬¬ä¸€ä¸ªç¤ºä¾‹

è®©æˆ‘ä»¬è¿è¡Œä¸€ä¸ªæœ€ç®€å•çš„ç¤ºä¾‹æ¥äº†è§£ Barter-rs çš„åŸºæœ¬ç”¨æ³•ã€‚

### ç¤ºä¾‹ä»£ç 

åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ `examples/quick_start.rs`ï¼š

```rust
use barter::{
    engine::{
        clock::LiveClock,
        state::{
            global::DefaultGlobalData,
            instrument::data::DefaultInstrumentMarketData,
            trading::TradingState,
        },
    },
    logging::init_logging,
    risk::DefaultRiskManager,
    strategy::DefaultStrategy,
    system::{
        builder::{AuditMode, EngineFeedMode, SystemArgs, SystemBuilder},
        config::SystemConfig,
    },
};
use barter_data::{
    streams::builder::dynamic::indexed::init_indexed_multi_exchange_market_stream,
    subscription::SubKind,
};
use barter_instrument::index::IndexedInstruments;
use std::{fs::File, io::BufReader, time::Duration};
use tokio::time::sleep;

const FILE_PATH_SYSTEM_CONFIG: &str = "barter/examples/config/system_config.json";

#[tokio::main]
async fn main() -> Result<(), Box<dyn std::error::Error>> {
    // 1. åˆå§‹åŒ–æ—¥å¿—ç³»ç»Ÿ
    init_logging();

    // 2. åŠ è½½ç³»ç»Ÿé…ç½®
    let SystemConfig {
        instruments,
        executions,
    } = load_config()?;

    // 3. æ„å»ºç´¢å¼•åŒ–çš„äº¤æ˜“å¯¹é›†åˆ
    let instruments = IndexedInstruments::new(instruments);

    // 4. åˆå§‹åŒ–å¸‚åœºæ•°æ®æµ
    let market_stream = init_indexed_multi_exchange_market_stream(
        &instruments,
        &[SubKind::PublicTrades, SubKind::OrderBooksL1],
    )
    .await?;

    // 5. æ„å»ºç³»ç»Ÿå‚æ•°
    let args = SystemArgs::new(
        &instruments,
        executions,
        LiveClock,                                    // ä½¿ç”¨å®æ—¶æ—¶é’Ÿ
        DefaultStrategy::default(),                    // ä½¿ç”¨é»˜è®¤ç­–ç•¥
        DefaultRiskManager::default(),                 // ä½¿ç”¨é»˜è®¤é£é™©ç®¡ç†å™¨
        market_stream,
        DefaultGlobalData::default(),
        |_| DefaultInstrumentMarketData::default(),
    );

    // 6. æ„å»ºå¹¶åˆå§‹åŒ–ç³»ç»Ÿ
    let mut system = SystemBuilder::new(args)
        .engine_feed_mode(EngineFeedMode::Iterator)   // åŒæ­¥æ¨¡å¼
        .audit_mode(AuditMode::Disabled)              // ç¦ç”¨å®¡è®¡ï¼ˆç®€åŒ–ç¤ºä¾‹ï¼‰
        .trading_state(TradingState::Disabled)         // åˆå§‹çŠ¶æ€ï¼šç¦ç”¨äº¤æ˜“
        .build()?
        .init_with_runtime(tokio::runtime::Handle::current())
        .await?;

    println!("âœ… ç³»ç»Ÿå¯åŠ¨æˆåŠŸï¼");

    // 7. å¯ç”¨äº¤æ˜“
    system.trading_state(TradingState::Enabled);
    println!("âœ… äº¤æ˜“å·²å¯ç”¨");

    // 8. è¿è¡Œ 5 ç§’
    println!("â³ ç³»ç»Ÿè¿è¡Œä¸­...");
    sleep(Duration::from_secs(5)).await;

    // 9. å…³é—­ç³»ç»Ÿ
    let (engine, _) = system.shutdown().await?;
    println!("âœ… ç³»ç»Ÿå·²å…³é—­");

    Ok(())
}

fn load_config() -> Result<SystemConfig, Box<dyn std::error::Error>> {
    let file = File::open(FILE_PATH_SYSTEM_CONFIG)?;
    let reader = BufReader::new(file);
    let config = serde_json::from_reader(reader)?;
    Ok(config)
}
```

### è¿è¡Œç¤ºä¾‹

å®é™…ä¸Šï¼Œé¡¹ç›®å·²ç»æä¾›äº†å®Œæ•´çš„ç¤ºä¾‹ã€‚è®©æˆ‘ä»¬ç›´æ¥è¿è¡Œç°æœ‰çš„ç¤ºä¾‹ï¼š

```bash
# è¿›å…¥ barter ç›®å½•
cd barter

# è¿è¡Œç¤ºä¾‹ï¼ˆéœ€è¦å…ˆå‡†å¤‡é…ç½®æ–‡ä»¶ï¼‰
cargo run --example engine_sync_with_live_market_data_and_mock_execution_and_audit
```

**æ³¨æ„**ï¼šè¿è¡Œç¤ºä¾‹éœ€è¦é…ç½®æ–‡ä»¶ `barter/examples/config/system_config.json`ï¼Œè¿™ä¸ªæ–‡ä»¶å·²ç»å­˜åœ¨äºé¡¹ç›®ä¸­ã€‚

## ğŸ” ç†è§£ä»£ç ç»“æ„

è®©æˆ‘ä»¬é€æ­¥ç†è§£ä¸Šé¢çš„ä»£ç ï¼š

### 1. ç³»ç»Ÿé…ç½®ï¼ˆSystemConfigï¼‰

```rust
let SystemConfig {
    instruments,  // äº¤æ˜“å¯¹é…ç½®ï¼ˆå¦‚ BTC/USDTï¼‰
    executions,   // æ‰§è¡Œé…ç½®ï¼ˆæ¨¡æ‹Ÿäº¤æ˜“æ‰€ï¼‰
} = load_config()?;
```

`SystemConfig` å®šä¹‰äº†ï¼š

-   **instruments**ï¼šè¦äº¤æ˜“çš„äº¤æ˜“å¯¹åˆ—è¡¨
-   **executions**ï¼šäº¤æ˜“æ‰€æ‰§è¡Œé…ç½®ï¼ˆæ¨¡æ‹Ÿæˆ–çœŸå®ï¼‰

### 2. ç´¢å¼•åŒ–äº¤æ˜“å¯¹ï¼ˆIndexedInstrumentsï¼‰

```rust
let instruments = IndexedInstruments::new(instruments);
```

`IndexedInstruments` å°†äº¤æ˜“å¯¹è½¬æ¢ä¸ºç´¢å¼•ç»“æ„ï¼Œå®ç° O(1) å¿«é€ŸæŸ¥æ‰¾ã€‚

### 3. å¸‚åœºæ•°æ®æµï¼ˆMarketStreamï¼‰

```rust
let market_stream = init_indexed_multi_exchange_market_stream(
    &instruments,
    &[SubKind::PublicTrades, SubKind::OrderBooksL1],
)
.await?;
```

`MarketStream` æä¾›å®æ—¶å¸‚åœºæ•°æ®ï¼š

-   `PublicTrades`ï¼šé€ç¬”äº¤æ˜“æ•°æ®
-   `OrderBooksL1`ï¼šè®¢å•ç°¿æ•°æ®

### 4. ç³»ç»Ÿå‚æ•°ï¼ˆSystemArgsï¼‰

```rust
let args = SystemArgs::new(
    &instruments,
    executions,
    LiveClock,                    // æ—¶é’Ÿï¼šå®æ—¶æˆ–å†å²
    DefaultStrategy::default(),    // ç­–ç•¥ï¼šç”Ÿæˆäº¤æ˜“ä¿¡å·
    DefaultRiskManager::default(), // é£é™©ç®¡ç†ï¼šæ£€æŸ¥è®¢å•
    market_stream,
    DefaultGlobalData::default(),
    |_| DefaultInstrumentMarketData::default(),
);
```

`SystemArgs` åŒ…å«æ„å»ºç³»ç»Ÿæ‰€éœ€çš„æ‰€æœ‰ç»„ä»¶ã€‚

### 5. ç³»ç»Ÿæ„å»ºå™¨ï¼ˆSystemBuilderï¼‰

```rust
let mut system = SystemBuilder::new(args)
    .engine_feed_mode(EngineFeedMode::Iterator)  // åŒæ­¥æ¨¡å¼
    .audit_mode(AuditMode::Disabled)            // ç¦ç”¨å®¡è®¡
    .trading_state(TradingState::Disabled)      // åˆå§‹ç¦ç”¨äº¤æ˜“
    .build()?
    .init_with_runtime(tokio::runtime::Handle::current())
    .await?;
```

`SystemBuilder` ä½¿ç”¨æ„å»ºå™¨æ¨¡å¼é…ç½®ç³»ç»Ÿï¼š

-   `engine_feed_mode`ï¼šEngine è¿è¡Œæ¨¡å¼ï¼ˆåŒæ­¥/å¼‚æ­¥ï¼‰
-   `audit_mode`ï¼šæ˜¯å¦å¯ç”¨å®¡è®¡æµ
-   `trading_state`ï¼šåˆå§‹äº¤æ˜“çŠ¶æ€

### 6. ç³»ç»Ÿæ§åˆ¶

```rust
// å¯ç”¨äº¤æ˜“
system.trading_state(TradingState::Enabled);

// å…³é—­ç³»ç»Ÿ
let (engine, _) = system.shutdown().await?;
```

ç³»ç»Ÿå¯åŠ¨åï¼Œå¯ä»¥é€šè¿‡ `system` å¯¹è±¡æ§åˆ¶äº¤æ˜“çŠ¶æ€å’Œæ‰§è¡Œå‘½ä»¤ã€‚

## ğŸ“ æ ¸å¿ƒæ¦‚å¿µé€Ÿè§ˆ

åœ¨æ·±å…¥å­¦ä¹ ä¹‹å‰ï¼Œå…ˆäº†è§£å‡ ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼š

### Engineï¼ˆäº¤æ˜“å¼•æ“ï¼‰

Engine æ˜¯ Barter-rs çš„æ ¸å¿ƒï¼Œè´Ÿè´£ï¼š

-   å¤„ç†å¸‚åœºäº‹ä»¶å’Œè´¦æˆ·äº‹ä»¶
-   ç»´æŠ¤äº¤æ˜“çŠ¶æ€
-   åè°ƒ Strategy å’Œ RiskManager

### Strategyï¼ˆäº¤æ˜“ç­–ç•¥ï¼‰

Strategy å®šä¹‰äº¤æ˜“é€»è¾‘ï¼š

-   ä½•æ—¶ä¹°å…¥ï¼ˆå…¥åœºè§„åˆ™ï¼‰
-   ä½•æ—¶å–å‡ºï¼ˆå‡ºåœºè§„åˆ™ï¼‰
-   å¦‚ä½•ç®¡ç†é£é™©

### RiskManagerï¼ˆé£é™©ç®¡ç†å™¨ï¼‰

RiskManager æ£€æŸ¥è®¢å•æ˜¯å¦ç¬¦åˆé£é™©è¦æ±‚ï¼š

-   è®¢å•æ•°é‡æ˜¯å¦è¿‡å¤§
-   æŒä»“æ˜¯å¦è¶…é™
-   èµ„é‡‘æ˜¯å¦å……è¶³

### EngineStateï¼ˆå¼•æ“çŠ¶æ€ï¼‰

EngineState ç»´æŠ¤ç³»ç»Ÿçš„å®Œæ•´çŠ¶æ€ï¼š

-   èµ„äº§ä½™é¢
-   æŒä»“ä¿¡æ¯
-   è®¢å•çŠ¶æ€
-   å¸‚åœºæ•°æ®

## âš ï¸ å¸¸è§é—®é¢˜

### é—®é¢˜ 1ï¼šç¼–è¯‘é”™è¯¯

**é”™è¯¯**ï¼š`cannot find crate 'barter'`

**è§£å†³**ï¼šç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œå‘½ä»¤ï¼Œæˆ–è€…ä½¿ç”¨ `cargo run --package barter --example ...`

### é—®é¢˜ 2ï¼šé…ç½®æ–‡ä»¶æ‰¾ä¸åˆ°

**é”™è¯¯**ï¼š`No such file or directory: system_config.json`

**è§£å†³**ï¼šç¡®ä¿é…ç½®æ–‡ä»¶è·¯å¾„æ­£ç¡®ï¼Œæˆ–è€…ä» `barter/examples/config/` ç›®å½•è¿è¡Œ

### é—®é¢˜ 3ï¼šç½‘ç»œè¿æ¥é—®é¢˜

**é”™è¯¯**ï¼šæ— æ³•è¿æ¥åˆ°äº¤æ˜“æ‰€

**è§£å†³**ï¼šæ£€æŸ¥ç½‘ç»œè¿æ¥ï¼Œæˆ–è€…ä½¿ç”¨æ¨¡æ‹Ÿäº¤æ˜“æ‰€ï¼ˆMockExchangeï¼‰

## âœ… æ£€æŸ¥æ¸…å•

å®Œæˆä»¥ä¸‹ä»»åŠ¡ï¼Œç¡®ä¿ä½ å·²ç»æŒæ¡äº†åŸºç¡€çŸ¥è¯†ï¼š

-   [ ] æˆåŠŸè¿è¡Œç¬¬ä¸€ä¸ªç¤ºä¾‹
-   [ ] ç†è§£ SystemConfig çš„ä½œç”¨
-   [ ] ç†è§£ SystemBuilder çš„é…ç½®é€‰é¡¹
-   [ ] çŸ¥é“å¦‚ä½•å¯ç”¨/ç¦ç”¨äº¤æ˜“
-   [ ] çŸ¥é“å¦‚ä½•å…³é—­ç³»ç»Ÿ

## ğŸ¯ ä¸‹ä¸€æ­¥

æ­å–œï¼ä½ å·²ç»å®Œæˆäº†å¿«é€Ÿå…¥é—¨ã€‚æ¥ä¸‹æ¥å»ºè®®å­¦ä¹ ï¼š

1. **[02-æ ¸å¿ƒæ¦‚å¿µç†è§£](./02-æ ¸å¿ƒæ¦‚å¿µç†è§£.md)** - æ·±å…¥ç†è§£ Engineã€Strategyã€RiskManager ç­‰æ ¸å¿ƒæ¦‚å¿µ
2. **[03-ç¬¬ä¸€ä¸ªäº¤æ˜“ç­–ç•¥](./03-ç¬¬ä¸€ä¸ªäº¤æ˜“ç­–ç•¥.md)** - ç¼–å†™ä½ çš„ç¬¬ä¸€ä¸ªäº¤æ˜“ç­–ç•¥

## ğŸ“š å»¶ä¼¸é˜…è¯»

-   [é¡¹ç›® README](../README.md) - äº†è§£é¡¹ç›®æ•´ä½“æ¶æ„
-   [æœ¯è¯­è¡¨](./æœ¯è¯­è¡¨.md) - æŸ¥çœ‹æœ¯è¯­å®šä¹‰
-   [API æ–‡æ¡£](https://docs.rs/barter/latest/barter/) - æŸ¥çœ‹è¯¦ç»† API æ–‡æ¡£

---

**å‡†å¤‡å¥½äº†å—ï¼Ÿè®©æˆ‘ä»¬ç»§ç»­å­¦ä¹ æ ¸å¿ƒæ¦‚å¿µï¼** â†’ [02-æ ¸å¿ƒæ¦‚å¿µç†è§£](./02-æ ¸å¿ƒæ¦‚å¿µç†è§£.md)
